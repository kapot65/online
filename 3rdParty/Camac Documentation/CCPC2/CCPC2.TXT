                             CCPC2

          КРЕЙТ КОНТРОЛЕР КАМАК НA БАЗЕ ВСТРОЕННОГО IBM PC


     CCPC2 архитектурно представляет собой бездисковый PC (Motherboard+
  VGA card + MIO card + Ethernet adapter) с добавлением платы сопряжения
  ISA - CAMAC. Конструктивно это модуль КАМАК шириной 3М, на лицевую панель
  которого  выведены разъемы синхронизации и подключения внешних устройств PC.
  В модуле также предусмотрена возможность подключения FDD и HDD, но для
  этого необходимо использовать дополнительный модуль КАМАК со встроенными
  дисководами.

      Лицевая панель.

  LINK   -    индикация обмена по сети;
  BUSY   -    индикация обмена по магистрали КАМАК;
  RESET  -    кнопка и LEMO (TTL отрицательной полярности);
  NET    -    разъем подключения Ethernet;
  KB     -    разъем подключения клавиатуры;
  VGA    -    разъем подключения монитора;
  LAM    -    TTL вход внешнего запроса на прерывание(аналогично LAM KAMAK);
  INFL   -    TTL вход внешнего флага (записывается только в регистр CCPC2,
              не вызывая L);
  OUTFL  -    программируемый TTL выход;
  COM    -    разъем подключения RS-232;


         Сопряжение ISA - CAMAC.

     Передача данных,контрольной и статусной информации осуществляется
  посредством пoртовых операций PC. Используются 3 16-ти разрядных порта
  с адресами 360-366.

  port 360 - регистр данных  W1-W16(запись), R1-R16(чтение);

  port 362 - регистр 3-его байта данных W17-W24, R17-r24 (бит 0-7),
             регистр 3-его байта LAM статуса L17-L23,EXTLAM,INFL (бит 8-15);

  port 364  - регистр контроля/статуса КАМАК
             Запись в бит 0 - установка/сброс сигнала INHIBIT:
                    в бит 1 - установка/сброс сигнала OUTFL ;
             Чтение   бит 0 - Q на магистрали КАМАК;
                      бит 1 - X на магистрали КАМАК;
                      бит 2 - L на магистрали КАМАК;

  port 366 - регистр NAF (запись), L1-L16 (чтение);
             NAF - бит 0-4  - F1-F16,
                   бит 5-8  - A1-A8,
                   бит 9-13 - BN0-BN4 (5-ти разрядный код N),
                   бит 14   - Z,
                   бит 15   - C;
             Чтение: бит 0-15 - L1-L16;


     Генерация циклов КАМАК.

     Запись в порт 366 (регистр NAF) вызывает генерацию цикла на магистрали
   КАМАК, обращения к другим регистрам контролера никаких действий на
   магистрали не производят.
   Таким образом для выполнения команд без обмена данными, а также генерации
   Z,C цикла необходимо произвести только запись кода команды в порт 366.
     Выполнение команд с передачей данных требует как минимум 2-х IO
   операций :
     Запись: 1) загрузка регистра данных по адресу 360 (при 24х разрядном
                обмене- 3ий байт по адресу 362);
             2) загрузка регистра NAF по адресу 366.
     Чтение: 1) загрузка регистра NAF по адресу 366;
             2) чтение регистра данных по адресу 360 (3ий байт-362).
   Сигналы Q,X,L можно тестировать чтением порта 364, биты 0-3 .

         Прерывание.

    Источником сигнала прерывания на ISA bus (IRQ3,IRQ10,IRQ11-задаются
   перемычками) являются как сигналы L на магистрали КАМАК, так и сигнал
   сигнал LAM с лицевой панели.
   Определение источника прерывания осуществляется чтением регистров
   статуса -362,366.
